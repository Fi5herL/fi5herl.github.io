<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UL 60730-1 é›»æ°£é–“éš™è©•ä¼°ç³»çµ± - ç¡¬é«”å·¥ç¨‹å¸«åˆ¤å®šæµç¨‹</title>
    <style>
        :root {
            --primary-color: #00529B;
            --secondary-color: #0073E6;
            --accent-color: #FFC107;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
            --light-text: #7f8c8d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-text);
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--light-text);
            font-size: 1.1rem;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .step-section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            animation: slideIn 0.6s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .step-number {
            background: rgba(255, 255, 255, 0.2);
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .step-content { padding: 2rem; }

        .step-description {
            background: #eaf5ff;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 0 8px 8px 0;
        }
        
        /* [STYLES FROM ORIGINAL CODE]... The existing styles for navigation, forms, tables, etc. are kept the same */
        .mockup-screen { background: var(--light-bg); border: 1px solid #dee2e6; border-radius: 12px; padding: 1rem; margin: 1rem 0; position: relative; overflow: hidden; }
        .mockup-canvas { background: radial-gradient(circle, #e1e8ed 1px, transparent 1px); background-size: 20px 20px; min-height: 300px; border-radius: 8px; position: relative; overflow: hidden; }
        .node { position: absolute; min-width: 160px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); border: 1px solid #ccc; font-size: 0.9rem; }
        .node-header { padding: 0.7rem; border-radius: 6px 6px 0 0; color: white; font-weight: 600; font-size: 0.85rem; }
        .node-header.input { background: linear-gradient(135deg, #55efc4, #00b894); }
        .node-content { padding: 0.8rem; background: white; border-radius: 0 0 6px 6px; font-size: 0.8rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.3rem; font-weight: 500; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 0.6rem; border: 1px solid #ced4da; border-radius: 4px; font-size: 0.9rem; }
        .form-group small { color: #777; font-size: 0.8rem; margin-top: 4px; display: block; }
        .table-display { overflow-x: auto; margin: 1rem 0; }
        .table-display table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .table-display th, .table-display td { border: 1px solid #dee2e6; padding: 0.6rem; text-align: center; }
        .table-display th { background: #f2f2f2; font-weight: 600; }
        .navigation { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 50; }
        .nav-button { background: linear-gradient(135deg, #74b9ff, var(--secondary-color)); color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .nav-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .nav-button:disabled { background: #95a5a6; cursor: not-allowed; transform: none; }
        .progress-bar { background: #e9ecef; border-radius: 10px; height: 8px; margin: 1rem 0; overflow: hidden; flex-grow: 1; max-width: 400px; }
        .progress-fill { background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); height: 100%; border-radius: 10px; transition: width 0.3s ease; }
        .control-panel { background: linear-gradient(135deg, #6a737d, #343a40); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; }
        .control-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .control-grid label { color: white; }
        .control-grid select, .control-grid input { border: 2px solid #fff; }
        .live-result { border: 2px solid; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; transition: all 0.3s ease; }
        .live-result.pass { background: linear-gradient(135deg, #e8f5e8, #d4edda); border-color: var(--success-color); }
        .live-result.fail { background: linear-gradient(135deg, #f8d7da, #f5c6cb); border-color: var(--danger-color); }
        .live-result.info { background: linear-gradient(135deg, #fff3cd, #ffeeba); border-color: var(--accent-color); }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1rem; }
        .result-item { font-family: 'Courier New', monospace; background: rgba(255, 255, 255, 0.7); padding: 0.8rem; border-radius: 6px; }
        .table-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 992px) { .table-grid { grid-template-columns: 1fr; } }
        .highlight-cell { background-color: var(--accent-color) !important; border: 2px solid #e6a800 !important; font-weight: bold !important; }
        .highlight-row { background-color: #fff3cd !important; }
        .btn { background: linear-gradient(135deg, #74b9ff, var(--secondary-color)); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; margin: 0.5rem 0.5rem 0.5rem 0; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .btn-danger { background: linear-gradient(135deg, #ff7675, var(--danger-color)); }


        /* --- NEW/REVISED Flowchart Styles --- */
        .flowchart-section {
            padding-top: 2rem;
            border-top: 2px solid #e9ecef;
            margin-top: 2rem;
        }
        .flowchart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px; /* Space between vertical nodes */
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        .flow-node {
            position: relative;
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 280px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            border: 1px solid #ccc;
        }
        /* Vertical connector line for all nodes EXCEPT the one right before a split */
        .flow-node:not(:last-child):not(.pre-split)::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 100%;
            width: 2px;
            height: 15px;
            background-color: #999;
            transform: translateX(-50%);
        }
        .flow-node.input { background-color: #e3f2fd; border-color: #90caf9; }
        .flow-node.process { background-color: #e8f5e9; border-color: #a5d6a7; }
        .flow-node.decision {
            background-color: #fff3e0;
            border-color: #ffcc80;
            width: 240px;
            height: 100px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); /* Diamond shape */
        }
        .flow-node.result { font-weight: bold; border-width: 2px; }
        .flow-node.pass { background-color: #d4edda; border-color: var(--success-color); color: #155724; }
        .flow-node.fail { background-color: #f8d7da; border-color: var(--danger-color); color: #721c24; }
        .flow-node.info { background-color: #fff3cd; border-color: var(--accent-color); color: #856404; }
        .flow-node strong { color: var(--primary-color); }

        /* The container for Pass/Fail branches */
        .flow-path-split {
            position: relative;
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 450px;
            margin-top: 30px; /* Space for T-connector */
        }
        /* Vertical line coming down to the T-junction */
        .flow-path-split::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 15px;
            background-color: #999;
        }
        /* Horizontal line of the T-junction */
        .flow-path-split::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #999;
        }
        
        .flow-path-branch {
            position: relative;
            display: flex;
            justify-content: center;
            flex-grow: 1;
        }
        /* Vertical line dropping down from the T-junction to each branch node */
        .flow-path-branch::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 15px;
            background-color: #999;
        }
        .flow-path-branch .flow-node {
            margin-top: 15px;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <!-- Header and Navigation sections remain unchanged -->
    <header class="header"><h1>ğŸ”§ UL 60730-1 é›»æ°£é–“éš™è©•ä¼°ç³»çµ±</h1><p>ç¡¬é«”å·¥ç¨‹å¸«çš„æ¨™æº–åŒ–åˆ¤å®šæµç¨‹</p></header>
    <nav class="navigation"><button class="nav-button" onclick="previousStep()" id="prevBtn" disabled>â† ä¸Šä¸€æ­¥</button><div style="display: flex; align-items: center; gap: 1rem;"><span id="stepIndicator">æ­¥é©Ÿ 1 / 5</span><div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 20%"></div></div></div><button class="nav-button" onclick="nextStep()" id="nextBtn">ä¸‹ä¸€æ­¥ â†’</button></nav>

    <div class="container">
        <!-- Steps 1-4 remain unchanged -->
        <div class="step-section" id="step1" style="display: block;"><div class="step-header"><div class="step-number">1</div><div><h2>å»ºç«‹è©•ä¼°æ¡ˆä¾‹</h2><p>ç‚ºä¸€å€‹ 240V AC å·¥æ¥­ç”¨æº«æ§å™¨å»ºç«‹é›»æ°£é–“éš™è©•ä¼°</p></div></div><div class="step-content"><div class="step-description"><strong>æƒ…å¢ƒï¼š</strong>UL å·¥ç¨‹å¸«éœ€è¦è©•ä¼°ä¸€å€‹ 240V AC å·¥æ¥­ç”¨æº«æ§å™¨é›»è·¯æ¿çš„é›»æ°£é–“éš™ã€‚ä»–é–‹å§‹å»ºç«‹ä¸€å€‹æ¨™æº–åŒ–çš„è©•ä¼°æµç¨‹ã€‚</div><div class="mockup-screen"><div style="padding: 1rem; background: white; border-radius: 8px;"><h4>å»ºç«‹æ–°è©•ä¼°</h4><div class="form-group"><label>è©•ä¼°åç¨±</label><input type="text" value="240Væº«æ§å™¨é›»æ°£é–“éš™è©•ä¼°" style="border: 2px solid var(--secondary-color);"></div><div class="form-group"><label>æè¿°</label><input type="text" value="åŸºæ–¼ IEC 60730-1 Table 21 &amp; 22 çš„é›»æ°£é–“éš™åˆ¤å®š"></div><div class="form-group"><label>é©ç”¨æ¨™æº–</label><select><option selected="">IEC 60730-1:2013+A1:2015</option></select></div><button class="btn">âœ¨ é–‹å§‹è©•ä¼°</button></div></div></div></div>
        <div class="step-section" id="step2" style="display: none;"><div class="step-header"><div class="step-number">2</div><div><h2>å®šç¾©è¼¸å…¥åƒæ•¸</h2><p>è¨­å®šæ‰€æœ‰è©•ä¼°æ‰€éœ€çš„é—œéµåƒæ•¸</p></div></div><div class="step-content"><div class="step-description"><strong>æ“ä½œï¼š</strong>å·¥ç¨‹å¸«æ ¹æ“šç”¢å“è¦æ ¼æ›¸å’Œé›»è·¯è¨­è¨ˆï¼Œè¨­å®šå·¥ä½œé›»å£“ã€ç³»çµ±é¡å‹ã€çµ•ç·£é¡å‹ç­‰æ‰€æœ‰å¿…è¦çš„è¼¸å…¥åƒæ•¸ã€‚</div><div class="mockup-canvas"><div class="node highlight" style="left: 50px; top: 30px; animation: 1.5s ease 0s infinite normal none running pulse;"><div class="node-header input">âš¡ å·¥ä½œé›»å£“</div><div class="node-content">å€¼: <strong>240V AC</strong></div></div><div class="node" style="left: 250px; top: 30px;"><div class="node-header input">ğŸ”Œ ç³»çµ±é¡å‹</div><div class="node-content">é¡å‹: <strong>ä¸‰ç›¸å››ç·š</strong></div></div><div class="node" style="left: 450px; top: 30px;"><div class="node-header input">ğŸ”’ çµ•ç·£é¡å‹</div><div class="node-content">é¡å‹: <strong>åŸºæœ¬çµ•ç·£</strong></div></div><div class="node" style="left: 50px; top: 130px;"><div class="node-header input">ğŸŒ«ï¸ æ±™æŸ“ç­‰ç´š</div><div class="node-content">ç­‰ç´š: <strong>PD2</strong></div></div><div class="node" style="left: 250px; top: 130px;"><div class="node-header input">ğŸ“ é‡æ¸¬é–“éš™</div><div class="node-content">å€¼: <strong>2.8 mm</strong></div></div></div></div></div>
        <div class="step-section" id="step3" style="display: none;"><div class="step-header"><div class="step-number">3</div><div><h2>æŸ¥é–± Table 21</h2><p>å¾å·¥ä½œé›»å£“ç¢ºå®šé¡å®šè„ˆè¡é›»å£“</p></div></div><div class="step-content"><div class="step-description"><strong>æ“ä½œï¼š</strong>æ ¹æ“šå·¥ä½œé›»å£“ (240V)ã€ç³»çµ±é¡å‹ (ä¸‰ç›¸) å’Œéé›»å£“é¡åˆ¥ (é è¨­ç‚º II)ï¼Œå¾ Table 21 æŸ¥å¾—é¡å®šè„ˆè¡é›»å£“ã€‚</div><div class="table-display"><table><thead><tr><th>å·¥ä½œé›»å£“ç¯„åœ (V)</th><th>ç³»çµ±é¡å‹</th><th>éé›»å£“é¡åˆ¥ II (V)</th></tr></thead><tbody><tr><td>â‰¤ 50</td><td>ä¸‰ç›¸</td><td>500</td></tr><tr class="highlight-row"><td class="highlight-cell">150-300</td><td>ä¸‰ç›¸</td><td class="highlight-cell">2500</td></tr><tr><td>300-600</td><td>ä¸‰ç›¸</td><td>4000</td></tr></tbody></table></div><div class="result-panel"><strong>æŸ¥è©¢çµæœ:</strong> å·¥ä½œé›»å£“ 240V è½åœ¨ "150-300V" ç¯„åœå…§ï¼Œå°æ‡‰é¡å®šè„ˆè¡é›»å£“ç‚º <strong>2500V (2.5kV)</strong>ã€‚</div></div></div>
        <div class="step-section" id="step4" style="display: none;"><div class="step-header"><div class="step-number">4</div><div><h2>æŸ¥é–± Table 22</h2><p>å¾è„ˆè¡é›»å£“ç¢ºå®šæœ€å°é›»æ°£é–“éš™</p></div></div><div class="step-content"><div class="step-description"><strong>æ“ä½œï¼š</strong>ä½¿ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„é¡å®šè„ˆè¡é›»å£“ (2.5kV)ï¼Œçµåˆçµ•ç·£é¡å‹ (åŸºæœ¬çµ•ç·£ â†’ Case B) å’Œæ±™æŸ“ç­‰ç´š (PD2)ï¼Œå¾ Table 22 æŸ¥å¾—è¦æ±‚çš„æœ€å°é›»æ°£é–“éš™ã€‚</div><div class="table-display"><table><thead><tr><th>è„ˆè¡é›»å£“ (kV)</th><th>Case</th><th>PD1 (mm)</th><th>PD2 (mm)</th><th>PD3 (mm)</th></tr></thead><tbody><tr><td>1.5</td><td>B</td><td>0.5</td><td>0.8</td><td>1.5</td></tr><tr class="highlight-row"><td class="highlight-cell">2.5</td><td>B</td><td>1.5</td><td class="highlight-cell">2.0</td><td>3.0</td></tr><tr><td>4.0</td><td>B</td><td>3.0</td><td>4.0</td><td>5.5</td></tr></tbody></table></div><div class="result-panel"><strong>æŸ¥è©¢çµæœ:</strong> 2.5kV + Case B + PD2 â†’ <strong>2.0mm</strong> é–“éš™è¦æ±‚ã€‚<br><strong>æœ€çµ‚åˆ¤å®š:</strong> é‡æ¸¬å€¼ 2.8mm â‰¥ è¦æ±‚å€¼ 2.0mm â†’ <span style="color: var(--success-color); font-weight: bold;">PASS âœ…</span></div></div></div>
        
        <!-- æ­¥é©Ÿ 5: å³æ™‚åˆ¤å®šç³»çµ±èˆ‡æµç¨‹åœ– (é‡å¤§ä¿®æ”¹) -->
        <div class="step-section" id="step5" style="display: none;">
            <div class="step-header">
                <div class="step-number">5</div>
                <div>
                    <h2>æ•´åˆåˆ¤å®šç³»çµ±èˆ‡æµç¨‹åœ–</h2>
                    <p>å³æ™‚äº’å‹•æŸ¥è©¢ä¸¦å¯è¦–åŒ–å®Œæ•´åˆ¤å®šé‚è¼¯</p>
                </div>
            </div>
            <div class="step-content">
                <div class="step-description">
                    <strong>UL å·¥ç¨‹å¸«çš„åˆ¤å®šå·¥ä½œå°ï¼š</strong>ä¸‹æ–¹æ‰€æœ‰åƒæ•¸å‡å¯å³æ™‚èª¿æ•´ã€‚èª¿æ•´å¾Œï¼Œç³»çµ±å°‡è‡ªå‹•é‡æ–°è¨ˆç®—ï¼Œä¸¦åœ¨é«˜äº®è¡¨æ ¼å’Œæµç¨‹åœ–ä¸­åæ˜ å‡ºæ–°çš„åˆ¤å®šè·¯å¾‘å’Œçµæœã€‚
                </div>
                
                <div class="control-panel">
                    <h3>ğŸ›ï¸ å³æ™‚åˆ¤å®šæ§åˆ¶é¢æ¿</h3>
                    <div class="control-grid">
                        <div class="form-group"><label for="workingVoltage">å·¥ä½œé›»å£“ (V)</label><select id="workingVoltage" onchange="updateLiveJudgment()"><option value="50">50</option><option value="120">120</option><option value="240" selected>240 â­</option><option value="480">480</option><option value="600">600</option></select></div>
                        <div class="form-group"><label for="systemType">ç³»çµ±é¡å‹</label><select id="systemType" onchange="updateLiveJudgment()"><option value="three-phase" selected>ä¸‰ç›¸å››ç·š â­</option><option value="single-phase">å–®ç›¸</option></select></div>
                        <div class="form-group"><label for="overvoltageCategory">éé›»å£“é¡åˆ¥</label><select id="overvoltageCategory" onchange="updateLiveJudgment()"><option value="I">I</option><option value="II" selected>II â­</option><option value="III">III</option><option value="IV">IV</option></select></div>
                        <div class="form-group"><label for="insulationType">çµ•ç·£é¡å‹</label><select id="insulationType" onchange="updateLiveJudgment()"><option value="basic" selected>åŸºæœ¬çµ•ç·£</option><option value="functional">åŠŸèƒ½çµ•ç·£</option><option value="reinforced">åŠ å¼·çµ•ç·£</option></select><small>åŸºæœ¬/åŠ å¼·: Case B, åŠŸèƒ½: Case A</small></div>
                        <div class="form-group"><label for="pollutionDegree">æ±™æŸ“ç­‰ç´š</label><select id="pollutionDegree" onchange="updateLiveJudgment()"><option value="PD1">PD1</option><option value="PD2" selected>PD2 â­</option><option value="PD3">PD3</option></select></div>
                        <div class="form-group"><label for="measuredGap">é‡æ¸¬é–“éš™ (mm)</label><input type="number" id="measuredGap" value="2.8" step="0.1" min="0" oninput="updateLiveJudgment()"></div>
                    </div>
                </div>

                <div class="live-result" id="liveResultPanel">
                    <h3>ğŸ¯ å³æ™‚åˆ¤å®šçµæœ</h3>
                    <div class="result-grid">
                        <div><h4>ğŸ“‹ Table 21 æŸ¥è©¢</h4><div class="result-item" id="table21Result"></div></div>
                        <div><h4>ğŸ“Š Table 22 æŸ¥è©¢</h4><div class="result-item" id="table22Result"></div></div>
                        <div><h4>âš–ï¸ æœ€çµ‚åˆ¤å®š</h4><div class="result-item" id="finalJudgment" style="font-weight: bold;"></div></div>
                    </div>
                </div>
                
                <div class="table-grid" style="margin-top: 2rem;">
                    <div>
                        <h4>ğŸ“‹ Table H.21 - é¡å®šè„ˆè¡é›»å£“ (V)</h4>
                        <div class="table-display"><table id="table21_display"></table></div>
                    </div>
                    <div>
                        <h4>ğŸ“Š Table H.22 - é›»æ°£é–“éš™ (mm) for Case A/B</h4>
                        <div class="table-display"><table id="table22_display"></table></div>
                    </div>
                </div>

                <div style="background: var(--light-bg); padding: 1.5rem; border-radius: 8px; margin-top: 2rem; border: 1px solid #ddd;">
                    <h4>ğŸ§ª å¿«é€Ÿæ¸¬è©¦æ¡ˆä¾‹</h4>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                        <button class="btn" onclick="loadTestCase('pass_case')">æ¡ˆä¾‹1: æ¨™æº–é€šé</button>
                        <button class="btn" onclick="loadTestCase('high_voltage')">æ¡ˆä¾‹2: é«˜å£“å·¥æ¥­</button>
                        <button class="btn" onclick="loadTestCase('functional_fail')">æ¡ˆä¾‹3: åŠŸèƒ½çµ•ç·£ (éœ€æ¸¬è©¦)</button>
                        <button class="btn btn-danger" onclick="loadTestCase('fail_case')">æ¡ˆä¾‹4: æ˜é¡¯å¤±æ•ˆ</button>
                    </div>
                </div>

                <!-- ä½ç½®å·²èª¿æ•´ï¼šåˆ¤å®šé‚è¼¯æµç¨‹åœ– -->
                <div class="flowchart-section">
                    <h3 style="text-align: center; margin-bottom: 2rem;">ğŸ” åˆ¤å®šé‚è¼¯æµç¨‹åœ–</h3>
                    <div class="flowchart-container" id="flowchart-container">
                        <!-- Flowchart is dynamically generated here by JS -->
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        // --- æ¨™æº–æ•¸æ“š (æ ¹æ“š IEC 60730-1:2013+A1:2015) ---
        const table21Data = {
            "â‰¤50":     { "three-phase": { I: 330, II: 500, III: 800, IV: 1500 }, "single-phase": { I: 500, II: 800, III: 1500, IV: 2500 } },
            "50-150":  { "three-phase": null,                                     "single-phase": { I: 800, II: 1500, III: 2500, IV: 4000 } },
            "150-300": { "three-phase": { I: 1500, II: 2500, III: 4000, IV: 6000 }, "single-phase": { I: 1500, II: 2500, III: 4000, IV: 6000 } },
            "300-600": { "three-phase": { I: 2500, II: 4000, III: 6000, IV: 8000 }, "single-phase": null }
        };
        
        const table22Data = {
            "0.33": { A: { PD1: 0.01, PD2: null, PD3: null }, B: { PD1: 0.01, PD2: 0.02, PD3: 0.03 }},
            "0.5":  { A: { PD1: 0.04, PD2: null, PD3: null }, B: { PD1: 0.04, PD2: 0.06, PD3: 0.1 }},
            "0.8":  { A: { PD1: 0.1,  PD2: null, PD3: null }, B: { PD1: 0.1,  PD2: 0.2,  PD3: 0.4 }},
            "1.5":  { A: { PD1: 0.5,  PD2: null, PD3: null }, B: { PD1: 0.5,  PD2: 0.8,  PD3: 1.5 }},
            "2.5":  { A: { PD1: 1.5,  PD2: null, PD3: null }, B: { PD1: 1.5,  PD2: 2.0,  PD3: 3.0 }},
            "4.0":  { A: { PD1: 3.0,  PD2: null, PD3: null }, B: { PD1: 3.0,  PD2: 4.0,  PD3: 5.5 }},
            "6.0":  { A: { PD1: 5.5,  PD2: null, PD3: null }, B: { PD1: 5.5,  PD2: 7.0,  PD3: 9.5 }},
            "8.0":  { A: { PD1: 8.0,  PD2: null, PD3: null }, B: { PD1: 8.0,  PD2: 10.0, PD3: 12.5 }}
        };

        // --- Helper Functions ---
        function getVoltageRange(v) {
            if (v <= 50) return "â‰¤50"; if (v <= 150) return "50-150";
            if (v <= 300) return "150-300"; if (v <= 600) return "300-600";
            return "300-600";
        }
        function getPulseVoltage(v, sys, cat) {
            const range = getVoltageRange(v);
            const data = table21Data[range];
            return data?.[sys]?.[cat] ?? null;
        }
        function determineInsulationCase(type) {
            return (type === 'basic' || type === 'reinforced') ? 'B' : 'A';
        }
        function getClearanceRequirement(pulseV, caseType, pd) {
            if (!pulseV) return null;
            const pulseKey = (pulseV / 1000).toFixed(2).replace(/\.0+$/, '').replace(/0+$/, '');
            const data = table22Data[pulseKey];
            return data?.[caseType]?.[pd] ?? null;
        }

        // --- Main Logic ---
        function updateLiveJudgment() {
            if (currentStep !== 5) return;
            const inputs = {
                workingVoltage: parseInt(document.getElementById('workingVoltage').value),
                systemType: document.getElementById('systemType').value,
                overvoltageCategory: document.getElementById('overvoltageCategory').value,
                insulationType: document.getElementById('insulationType').value,
                pollutionDegree: document.getElementById('pollutionDegree').value,
                measuredGap: parseFloat(document.getElementById('measuredGap').value)
            };
            const pulseVoltage = getPulseVoltage(inputs.workingVoltage, inputs.systemType, inputs.overvoltageCategory);
            const caseType = determineInsulationCase(inputs.insulationType);
            const requiredClearance = getClearanceRequirement(pulseVoltage, caseType, inputs.pollutionDegree);
            updateResultDisplay(inputs, pulseVoltage, caseType, requiredClearance);
            updateTableHighlights(inputs, pulseVoltage, caseType);
            updateFlowchart(inputs, pulseVoltage, caseType, requiredClearance);
        }

        function updateResultDisplay(inputs, pulseV, caseT, reqC) {
            const systemText = inputs.systemType === 'three-phase' ? 'ä¸‰ç›¸' : 'å–®ç›¸';
            const resultPanel = document.getElementById('liveResultPanel');
            const finalJudgmentEl = document.getElementById('finalJudgment');
            document.getElementById('table21Result').textContent = pulseV ? `${inputs.workingVoltage}V + ${systemText} + ${inputs.overvoltageCategory} â†’ ${pulseV}V (${pulseV/1000}kV)` : 'è¼¸å…¥æ¢ä»¶ä¸é©ç”¨ (N/A)';
            let table22Text;
            if (pulseV === null) {
                table22Text = 'N/A';
            } else if (reqC === null) {
                table22Text = `${pulseV/1000}kV + Case ${caseT} + ${inputs.pollutionDegree} â†’ éœ€é›»æ°£å¼·åº¦æ¸¬è©¦`;
            } else {
                table22Text = `${pulseV/1000}kV + Case ${caseT} + ${inputs.pollutionDegree} â†’ ${reqC.toFixed(2)}mm`;
            }
            document.getElementById('table22Result').textContent = table22Text;
            if (reqC !== null && !isNaN(inputs.measuredGap)) {
                const isPassed = inputs.measuredGap >= reqC;
                finalJudgmentEl.textContent = `${inputs.measuredGap.toFixed(1)}mm ${isPassed ? 'â‰¥' : '<'} ${reqC.toFixed(2)}mm â†’ ${isPassed ? 'PASS âœ…' : 'FAIL âŒ'}`;
                resultPanel.className = 'live-result ' + (isPassed ? 'pass' : 'fail');
            } else if (reqC === null) {
                finalJudgmentEl.textContent = 'éœ€ä¾æ¨™æº–é€²è¡Œé›»æ°£å¼·åº¦æ¸¬è©¦';
                resultPanel.className = 'live-result info';
            } else {
                finalJudgmentEl.textContent = 'åˆ¤å®šæ‰€éœ€è³‡è¨Šä¸å®Œæ•´';
                resultPanel.className = 'live-result info';
            }
        }
        
        function updateFlowchart(inputs, pulseV, caseT, reqC) {
            const container = document.getElementById('flowchart-container');
            let finalHtml = '';
            
            if (reqC !== null) { // Pass or Fail path
                const isPassed = inputs.measuredGap >= reqC;
                finalHtml = `
                    <div class="flow-node process">è¦æ±‚é–“éš™: <strong>${reqC.toFixed(2)}mm</strong></div>
                    <div class="flow-node decision pre-split">é‡æ¸¬å€¼ <strong>${inputs.measuredGap.toFixed(1)}mm</strong> &ge; è¦æ±‚å€¼?</div>
                    <div class="flow-path-split">
                        <div class="flow-path-branch">
                            <div class="flow-node result ${isPassed ? 'pass' : ''}" style="opacity:${isPassed ? 1 : 0.3}">PASS âœ…</div>
                        </div>
                        <div class="flow-path-branch">
                            <div class="flow-node result ${!isPassed ? 'fail' : ''}" style="opacity:${!isPassed ? 1 : 0.3}">FAIL âŒ</div>
                        </div>
                    </div>`;
            } else { // Testing Required path
                finalHtml = `<div class="flow-node result info">çµæœ: éœ€é€²è¡Œé›»æ°£å¼·åº¦æ¸¬è©¦</div>`;
            }
            
            container.innerHTML = `
                <div class="flow-node input"><strong>è¼¸å…¥ï¼š</strong>${inputs.workingVoltage}V, ${inputs.overvoltageCategory}, ${inputs.insulationType}, ${inputs.pollutionDegree}</div>
                <div class="flow-node process"><strong>Table 21 æŸ¥è¡¨ï¼š</strong>ç”±å·¥ä½œé›»å£“ç­‰ â†’ é¡å®šè„ˆè¡é›»å£“ <strong>${pulseV ? `${pulseV/1000}kV` : 'N/A'}</strong></div>
                <div class="flow-node process"><strong>Case åˆ¤å®šï¼š</strong>ç”±çµ•ç·£é¡å‹ â†’ <strong>Case ${caseT}</strong></div>
                <div class="flow-node decision ${reqC === null ? '' : 'pre-split'}"><div>Table 22 æŸ¥è¡¨<br>(${pulseV ? `${pulseV/1000}kV` : 'N/A'}, Case ${caseT}, ${inputs.pollutionDegree})</div></div>
                ${finalHtml}
            `;
        }

        function createTables() {
            const t21 = document.getElementById('table21_display');
            let t21Html = '<thead><tr><th>é›»å£“ (V)</th><th>ç³»çµ±</th><th>I</th><th>II</th><th>III</th><th>IV</th></tr></thead><tbody>';
            const ranges = ["â‰¤50", "50-150", "150-300", "300-600"];
            ranges.forEach(r => {
                ["single-phase", "three-phase"].forEach(s => {
                    if(table21Data[r]?.[s]) {
                        const d = table21Data[r][s];
                        t21Html += `<tr data-range="${r}" data-system="${s}"><td>${r}</td><td>${s==='single-phase'?'å–®ç›¸':'ä¸‰ç›¸'}</td><td>${d.I}</td><td>${d.II}</td><td>${d.III}</td><td>${d.IV}</td></tr>`;
                    }
                });
            });
            t21.innerHTML = t21Html + '</tbody>';
            const t22 = document.getElementById('table22_display');
            let t22Html = '<thead><tr><th>è„ˆè¡ (kV)</th><th>Case</th><th>PD1</th><th>PD2</th><th>PD3</th></tr></thead><tbody>';
            Object.keys(table22Data).forEach(kv => {
                ['A', 'B'].forEach(c => {
                    const d = table22Data[kv][c];
                    t22Html += `<tr data-kv="${kv}" data-case="${c}"><td>${kv}</td><td>${c}</td><td>${d.PD1??'æ¸¬è©¦'}</td><td>${d.PD2??'æ¸¬è©¦'}</td><td>${d.PD3??'æ¸¬è©¦'}</td></tr>`;
                });
            });
            t22.innerHTML = t22Html + '</tbody>';
        }

        function updateTableHighlights(inputs, pulseV, caseT) {
            document.querySelectorAll('#table21_display tr, #table22_display tr').forEach(r => r.classList.remove('highlight-row'));
            document.querySelectorAll('#table21_display td, #table22_display td').forEach(c => c.classList.remove('highlight-cell'));
            const range = getVoltageRange(inputs.workingVoltage);
            const catIndex = {I:2, II:3, III:4, IV:5}[inputs.overvoltageCategory];
            const t21Row = document.querySelector(`#table21_display tr[data-range="${range}"][data-system="${inputs.systemType}"]`);
            if (t21Row) {
                t21Row.classList.add('highlight-row');
                t21Row.cells[catIndex]?.classList.add('highlight-cell');
            }
            if (pulseV) {
                const pulseKey = (pulseV / 1000).toFixed(2).replace(/\.0+$/, '').replace(/0+$/, '');
                const pdIndex = {PD1:2, PD2:3, PD3:4}[inputs.pollutionDegree];
                const t22Row = document.querySelector(`#table22_display tr[data-kv="${pulseKey}"][data-case="${caseT}"]`);
                if (t22Row) {
                    t22Row.classList.add('highlight-row');
                    t22Row.cells[pdIndex]?.classList.add('highlight-cell');
                }
            }
        }
        
        const testCases = {
            'pass_case':     { v: '240', sys: 'three-phase', cat: 'II', ins: 'basic', pd: 'PD2', gap: '2.8' },
            'high_voltage':  { v: '480', sys: 'three-phase', cat: 'III', ins: 'reinforced', pd: 'PD2', gap: '8.0' },
            'functional_fail':{ v: '240', sys: 'single-phase', cat: 'II', ins: 'functional', pd: 'PD2', gap: '1.0' },
            'fail_case':     { v: '240', sys: 'three-phase', cat: 'II', ins: 'basic', pd: 'PD2', gap: '1.5' },
        };
        function loadTestCase(caseName) {
            const c = testCases[caseName];
            document.getElementById('workingVoltage').value = c.v;
            document.getElementById('systemType').value = c.sys;
            document.getElementById('overvoltageCategory').value = c.cat;
            document.getElementById('insulationType').value = c.ins;
            document.getElementById('pollutionDegree').value = c.pd;
            document.getElementById('measuredGap').value = c.gap;
            updateLiveJudgment();
        }

        function updateDisplay() {
            for (let i = 1; i <= totalSteps; i++) document.getElementById(`step${i}`).style.display = i === currentStep ? 'block' : 'none';
            document.getElementById('stepIndicator').textContent = `æ­¥é©Ÿ ${currentStep} / ${totalSteps}`;
            document.getElementById('progressFill').style.width = `${(currentStep / totalSteps) * 100}%`;
            document.getElementById('prevBtn').disabled = currentStep === 1;
            document.getElementById('nextBtn').disabled = currentStep === totalSteps;
            document.getElementById('nextBtn').textContent = currentStep === totalSteps ? 'å®Œæˆ âœ…' : 'ä¸‹ä¸€æ­¥ â†’';
            if (currentStep === 5) setTimeout(updateLiveJudgment, 50);
        }
        function nextStep() { if (currentStep < totalSteps) { currentStep++; updateDisplay(); window.scrollTo(0,0); } }
        function previousStep() { if (currentStep > 1) { currentStep--; updateDisplay(); window.scrollTo(0,0); } }
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
            if (e.key === 'ArrowLeft') previousStep();
            else if (e.key === 'ArrowRight') nextStep();
        });
        window.onload = () => { createTables(); updateDisplay(); };
    </script>
</body>
</html>